var W=Object.defineProperty,_=(t,e,i)=>e in t?W(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,p=(t,e,i)=>(_(t,typeof e!="symbol"?e+"":e,i),i);let O=-1;const v=t=>{addEventListener("pageshow",e=>{e.persisted&&(O=e.timeStamp,t(e))},!0)},d=(t,e,i,n)=>{let r,s;return a=>{e.value>=0&&(a||n)&&(s=e.value-(r??0),(s||r===void 0)&&(r=e.value,e.delta=s,e.rating=((o,c)=>o>c[1]?"poor":o>c[0]?"needs-improvement":"good")(e.value,i),t(e)))}},w=t=>{requestAnimationFrame(()=>requestAnimationFrame(()=>t()))},A=()=>{const t=performance.getEntriesByType("navigation")[0];if(t&&t.responseStart>0&&t.responseStart<performance.now())return t},f=()=>{const t=A();return(t==null?void 0:t.activationStart)??0},h=(t,e=-1)=>{const i=A();let n="navigate";return O>=0?n="back-forward-cache":i&&(document.prerendering||f()>0?n="prerender":document.wasDiscarded?n="restore":i.type&&(n=i.type.replace(/_/g,"-"))),{name:t,value:e,rating:"good",delta:0,entries:[],id:`v5-${Date.now()}-${Math.floor(8999999999999*Math.random())+1e12}`,navigationType:n}},P=new WeakMap;function I(t,e){return P.get(t)||P.set(t,new e),P.get(t)}class z{constructor(){p(this,"t"),p(this,"i",0),p(this,"o",[])}h(e){var i;if(e.hadRecentInput)return;const n=this.o[0],r=this.o.at(-1);this.i&&n&&r&&e.startTime-r.startTime<1e3&&e.startTime-n.startTime<5e3?(this.i+=e.value,this.o.push(e)):(this.i=e.value,this.o=[e]),(i=this.t)==null||i.call(this,e)}}const g=(t,e,i={})=>{try{if(PerformanceObserver.supportedEntryTypes.includes(t)){const n=new PerformanceObserver(r=>{Promise.resolve().then(()=>{e(r.getEntries())})});return n.observe({type:t,buffered:!0,...i}),n}}catch{}},F=t=>{let e=!1;return()=>{e||(t(),e=!0)}};let m=-1;const D=new Set,M=()=>document.visibilityState!=="hidden"||document.prerendering?1/0:0,L=t=>{if(document.visibilityState==="hidden"){if(t.type==="visibilitychange")for(const e of D)e();isFinite(m)||(m=t.type==="visibilitychange"?t.timeStamp:0,removeEventListener("prerenderingchange",L,!0))}},y=()=>{var t;if(m<0){const e=f();m=(document.prerendering||(t=globalThis.performance.getEntriesByType("visibility-state").filter(i=>i.name==="hidden"&&i.startTime>e)[0])==null?void 0:t.startTime)??M(),addEventListener("visibilitychange",L,!0),addEventListener("prerenderingchange",L,!0),v(()=>{setTimeout(()=>{m=M()})})}return{get firstHiddenTime(){return m},onHidden(e){D.add(e)}}},b=t=>{document.prerendering?addEventListener("prerenderingchange",()=>t(),!0):t()},k=[1800,3e3],G=(t,e={})=>{b(()=>{const i=y();let n,r=h("FCP");const s=g("paint",a=>{for(const o of a)o.name==="first-contentful-paint"&&(s.disconnect(),o.startTime<i.firstHiddenTime&&(r.value=Math.max(o.startTime-f(),0),r.entries.push(o),n(!0)))});s&&(n=d(t,r,k,e.reportAllChanges),v(a=>{r=h("FCP"),n=d(t,r,k,e.reportAllChanges),w(()=>{r.value=performance.now()-a.timeStamp,n(!0)})}))})},B=[.1,.25],X=(t,e={})=>{const i=y();G(F(()=>{let n,r=h("CLS",0);const s=I(e,z),a=c=>{for(const l of c)s.h(l);s.i>r.value&&(r.value=s.i,r.entries=s.o,n())},o=g("layout-shift",a);o&&(n=d(t,r,B,e.reportAllChanges),i.onHidden(()=>{a(o.takeRecords()),n(!0)}),v(()=>{s.i=0,r=h("CLS",0),n=d(t,r,B,e.reportAllChanges),w(()=>n())}),setTimeout(n))}))};let $=0,C=1/0,T=0;const J=t=>{for(const e of t)e.interactionId&&(C=Math.min(C,e.interactionId),T=Math.max(T,e.interactionId),$=T?(T-C)/7+1:0)};let S;const H=()=>S?$:performance.interactionCount??0,K=()=>{"interactionCount"in performance||S||(S=g("event",J,{type:"event",buffered:!0,durationThreshold:0}))};let x=0;class Q{constructor(){p(this,"u",[]),p(this,"l",new Map),p(this,"m"),p(this,"p")}v(){x=H(),this.u.length=0,this.l.clear()}L(){const e=Math.min(this.u.length-1,Math.floor((H()-x)/50));return this.u[e]}h(e){var i,n;if((i=this.m)==null||i.call(this,e),!e.interactionId&&e.entryType!=="first-input")return;const r=this.u.at(-1);let s=this.l.get(e.interactionId);if(s||this.u.length<10||e.duration>r.P){if(s?e.duration>s.P?(s.entries=[e],s.P=e.duration):e.duration===s.P&&e.startTime===s.entries[0].startTime&&s.entries.push(e):(s={id:e.interactionId,entries:[e],P:e.duration},this.l.set(s.id,s),this.u.push(s)),this.u.sort((a,o)=>o.P-a.P),this.u.length>10){const a=this.u.splice(10);for(const o of a)this.l.delete(o.id)}(n=this.p)==null||n.call(this,s)}}}const j=t=>{const e=globalThis.requestIdleCallback||setTimeout;document.visibilityState==="hidden"?t():(t=F(t),addEventListener("visibilitychange",t,{once:!0,capture:!0}),e(()=>{t(),removeEventListener("visibilitychange",t,{capture:!0})}))},N=[200,500],Y=(t,e={})=>{if(!globalThis.PerformanceEventTiming||!("interactionId"in PerformanceEventTiming.prototype))return;const i=y();b(()=>{K();let n,r=h("INP");const s=I(e,Q),a=c=>{j(()=>{for(const u of c)s.h(u);const l=s.L();l&&l.P!==r.value&&(r.value=l.P,r.entries=l.entries,n())})},o=g("event",a,{durationThreshold:e.durationThreshold??40});n=d(t,r,N,e.reportAllChanges),o&&(o.observe({type:"first-input",buffered:!0}),i.onHidden(()=>{a(o.takeRecords()),n(!0)}),v(()=>{s.v(),r=h("INP"),n=d(t,r,N,e.reportAllChanges)}))})};class U{constructor(){p(this,"m")}h(e){var i;(i=this.m)==null||i.call(this,e)}}const R=[2500,4e3],Z=(t,e={})=>{b(()=>{const i=y();let n,r=h("LCP");const s=I(e,U),a=c=>{e.reportAllChanges||(c=c.slice(-1));for(const l of c)s.h(l),l.startTime<i.firstHiddenTime&&(r.value=Math.max(l.startTime-f(),0),r.entries=[l],n())},o=g("largest-contentful-paint",a);if(o){n=d(t,r,R,e.reportAllChanges);const c=F(()=>{a(o.takeRecords()),o.disconnect(),n(!0)}),l=u=>{u.isTrusted&&(j(c),removeEventListener(u.type,l,{capture:!0}))};for(const u of["keydown","click","visibilitychange"])addEventListener(u,l,{capture:!0});v(u=>{r=h("LCP"),n=d(t,r,R,e.reportAllChanges),w(()=>{r.value=performance.now()-u.timeStamp,n(!0)})})}})},q=[800,1800],E=t=>{document.prerendering?b(()=>E(t)):document.readyState!=="complete"?addEventListener("load",()=>E(t),!0):setTimeout(t)},V=(t,e={})=>{let i=h("TTFB"),n=d(t,i,q,e.reportAllChanges);E(()=>{const r=A();r&&(i.value=Math.max(r.responseStart-f(),0),i.entries=[r],n(!0),v(()=>{i=h("TTFB",0),n=d(t,i,q,e.reportAllChanges),n(!0)}))})};export{B as CLSThresholds,k as FCPThresholds,N as INPThresholds,R as LCPThresholds,q as TTFBThresholds,X as onCLS,G as onFCP,Y as onINP,Z as onLCP,V as onTTFB};
