import{j as e,m as I,an as O,J as $,bw as q,bx as H,by as J,bz as T,as as Z,w as G,ak as K,aC as Q,al as V,o as W,ae as X,a1 as P,bu as M,aZ as ee}from"./vendor-ui-834bd4ab.js";import{r as i,f as se,e as ae}from"./vendor-react-fa5d0322.js";import{F as D}from"./ForumLayout-6fd4a37b.js";import{C as p}from"./card-6b919bd6.js";import{B as l}from"./main-644effba.js";import{B as S}from"./badge-6dffecd3.js";import{T as U}from"./textarea-6044bca8.js";import{d as te,e as re,v as R}from"./forum-715b09c2.js";import"./input-e1c81c4b.js";import"./vendor-helmet-7425e547.js";import"./vendor-firebase-cb809cd2.js";const le=({topic:g,posts:j=[],onReply:r,onLike:c,onDislike:y,onBookmark:n,onMarkSolution:f,onEdit:d,onDelete:x,onReport:o,loading:v=!1,className:N=""})=>{const[m,C]=i.useState(""),[_,w]=i.useState(null),[A,k]=i.useState(null),[h,b]=i.useState(""),B=()=>{m.trim()&&(r==null||r(m,_||void 0),C(""),w(null))},E=s=>{k(s.id),b(s.content)},L=s=>{h.trim()&&(d==null||d(s,h),k(null),b(""))},z=s=>{switch(s){case"expert":return"bg-purple-100 text-purple-800 border-purple-200";case"moderator":return"bg-blue-100 text-blue-800 border-blue-200";case"admin":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},F=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});return v?e.jsxs("div",{className:`space-y-6 ${N}`,children:[e.jsx(p,{className:"p-6 animate-pulse",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"h-20 bg-gray-200 rounded"})]})}),[...Array(3)].map((s,a)=>e.jsx(p,{className:"p-6 animate-pulse",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),e.jsx("div",{className:"h-16 bg-gray-200 rounded"})]})},a))]}):g?e.jsxs("div",{className:`space-y-6 ${N}`,children:[e.jsx("div",{className:"space-y-4",children:j.map((s,a)=>e.jsx(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:a*.1},children:e.jsx(p,{className:`p-6 ${s.isSolution?"border-green-200 bg-green-50":""}`,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center",children:e.jsx(O,{className:"w-5 h-5 text-gray-500"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"font-medium text-gray-900",children:s.author.name}),e.jsx(S,{className:z(s.author.role),children:s.author.role}),s.isExpertAnswer&&e.jsxs(S,{className:"bg-purple-100 text-purple-800",children:[e.jsx($,{className:"w-3 h-3 mr-1"}),"Expert"]}),s.isSolution&&e.jsxs(S,{className:"bg-green-100 text-green-800",children:[e.jsx($,{className:"w-3 h-3 mr-1"}),"Solution"]})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-500",children:[e.jsx("span",{children:F(s.createdAt)}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:[s.author.reputation," reputation"]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>f==null?void 0:f(s.id),disabled:s.isSolution,children:e.jsx($,{className:"w-4 h-4"})}),e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>o==null?void 0:o(s.id),children:e.jsx(q,{className:"w-4 h-4"})})]})]}),A===s.id?e.jsxs("div",{className:"space-y-3",children:[e.jsx(U,{value:h,onChange:t=>b(t.target.value),rows:6,className:"w-full"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(l,{size:"sm",onClick:()=>L(s.id),className:"bg-blue-600 hover:bg-blue-700",children:"Save"}),e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>k(null),children:"Cancel"})]})]}):e.jsx("div",{className:"prose max-w-none",children:e.jsx("p",{className:"text-gray-700 leading-relaxed whitespace-pre-wrap",children:s.content})}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(l,{variant:"ghost",size:"sm",onClick:()=>c==null?void 0:c(s.id),className:s.userLiked?"text-red-500":"text-gray-500",children:[e.jsx(H,{className:"w-4 h-4 mr-1"}),s.likes]}),e.jsxs(l,{variant:"ghost",size:"sm",onClick:()=>y==null?void 0:y(s.id),className:s.userDisliked?"text-red-500":"text-gray-500",children:[e.jsx(J,{className:"w-4 h-4 mr-1"}),s.dislikes]}),e.jsxs(l,{variant:"ghost",size:"sm",onClick:()=>w(s.id),children:[e.jsx(T,{className:"w-4 h-4 mr-1"}),"Reply"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>E(s),children:e.jsx(Z,{className:"w-4 h-4"})}),e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>x==null?void 0:x(s.id),className:"text-red-500 hover:text-red-700",children:e.jsx(G,{className:"w-4 h-4"})})]})]})]})})},s.id))}),e.jsxs(p,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:_?"Reply to Post":"Add Your Reply"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(U,{value:m,onChange:s=>C(s.target.value),placeholder:"Share your thoughts and help the community...",rows:6,className:"w-full"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Be respectful and helpful. Remember, this is a professional tax forum."}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(l,{variant:"ghost",onClick:()=>w(null),children:"Cancel"}),e.jsx(l,{onClick:B,disabled:!m.trim(),className:"bg-blue-600 hover:bg-blue-700",children:"Post Reply"})]})]})]})]})]}):null},ye=()=>{const{topicSlug:g}=se(),j=ae(),[r,c]=i.useState(null),[y,n]=i.useState([]),[f,d]=i.useState(!0),[x,o]=i.useState(null),[v,N]=i.useState(!1),[m,C]=i.useState(!1),_=s=>({id:s.id.toString(),title:s.title,slug:s.slug,content:s.content,author:{id:"1",name:`${s.author_name||"Anonymous"} ${s.author_lastname||""}`.trim(),role:s.author_karma>100?"expert":"member"},category:{id:s.category_slug,name:s.category_name,slug:s.category_slug,color:s.category_color||"#3B82F6"},tags:[],status:s.status,isSolved:s.is_solved,views:s.views||0,likes:s.upvotes||0,userLiked:s.user_vote==="up",userBookmarked:!1,createdAt:s.created_at,updatedAt:s.last_reply_at||s.created_at}),w=s=>({id:s.id.toString(),content:s.content,author:{id:"1",name:`${s.author_name||"Anonymous"} ${s.author_lastname||""}`.trim(),role:s.is_expert_answer?"expert":"member",reputation:s.author_karma||0},isSolution:s.is_solution,isExpertAnswer:s.is_expert_answer,likes:s.upvotes||0,dislikes:s.downvotes||0,userLiked:s.user_vote==="up",userDisliked:s.user_vote==="down",createdAt:s.created_at,updatedAt:s.created_at});i.useEffect(()=>{g&&(async()=>{d(!0),o(null);try{const a=await te(g);if(!a){o("Topic not found"),d(!1);return}const t=_(a);c(t),N(t.userLiked);const Y=(await re(a.id)).map(w);n(Y)}catch(a){console.error("Error fetching topic:",a),o(a.message||"Failed to load topic")}finally{d(!1)}})()},[g]);const A=async s=>{if(s===(r==null?void 0:r.id))try{await R("topic",parseInt(r.id),"up"),N(!v),c(a=>({...a,likes:v?a.likes-1:a.likes+1}))}catch(a){console.error("Error voting:",a)}else try{await R("post",parseInt(s),"up"),n(a=>a.map(t=>t.id===s?{...t,likes:t.userLiked?t.likes-1:t.likes+1,userLiked:!t.userLiked}:t))}catch(a){console.error("Error voting:",a)}},k=async s=>{try{await R("post",parseInt(s),"down"),n(a=>a.map(t=>t.id===s?{...t,dislikes:t.userDisliked?t.dislikes-1:t.dislikes+1,userDisliked:!t.userDisliked}:t))}catch(a){console.error("Error voting:",a)}},h=()=>{C(!m)},b=s=>{n(a=>a.map(t=>t.id===s?{...t,isSolution:!0}:{...t,isSolution:!1})),c(a=>({...a,isSolved:!0}))},B=(s,a)=>{const t={id:Date.now().toString(),content:s,author:{id:"current-user",name:"You",role:"member",reputation:100},isSolution:!1,isExpertAnswer:!1,likes:0,dislikes:0,userLiked:!1,userDisliked:!1,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};n(u=>[...u,t])},E=(s,a)=>{n(t=>t.map(u=>u.id===s?{...u,content:a,updatedAt:new Date().toISOString()}:u))},L=s=>{n(a=>a.filter(t=>t.id!==s))},z=s=>{},F=()=>{navigator.share?navigator.share({title:r==null?void 0:r.title,text:r==null?void 0:r.content,url:window.location.href}):navigator.clipboard.writeText(window.location.href)};return f?e.jsx(D,{children:e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(K,{className:"w-8 h-8 animate-spin text-blue-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading topic..."})]})}):x?e.jsx(D,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Q,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Error Loading Topic"}),e.jsx("p",{className:"text-gray-600 mb-6",children:x}),e.jsxs("div",{className:"flex justify-center space-x-4",children:[e.jsx(l,{onClick:()=>window.location.reload(),children:"Try Again"}),e.jsx(l,{variant:"outline",onClick:()=>j("/forum"),children:"Back to Forum"})]})]})}):r?e.jsx(D,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[e.jsx("div",{className:"flex items-center space-x-4 mb-6",children:e.jsxs(l,{variant:"ghost",onClick:()=>j(`/forum/category/${r.category.slug}`),className:"flex items-center",children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Back to ",r.category.name]})}),e.jsx(p,{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:r.title}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-500 mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(O,{className:"w-4 h-4 mr-1"}),e.jsx("span",{className:"font-medium",children:r.author.name}),e.jsx(S,{className:"ml-2 bg-gray-100 text-gray-800",children:r.author.role})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(W,{className:"w-4 h-4 mr-1"}),new Date(r.createdAt).toLocaleDateString()]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(X,{className:"w-4 h-4 mr-1"}),r.views," views"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(l,{variant:"ghost",size:"sm",onClick:()=>A(r.id),className:v?"text-red-500":"text-gray-500",children:[e.jsx(P,{className:"w-4 h-4 mr-1"}),r.likes]}),e.jsx(l,{variant:"ghost",size:"sm",onClick:h,className:m?"text-blue-500":"text-gray-500",children:e.jsx(M,{className:"w-4 h-4"})}),e.jsx(l,{variant:"ghost",size:"sm",onClick:F,children:e.jsx(ee,{className:"w-4 h-4"})})]})]}),r.tags&&r.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:r.tags.map(s=>e.jsxs(S,{variant:"outline",children:["#",s]},s))}),e.jsx("div",{className:"prose max-w-none",children:e.jsx("p",{className:"text-gray-700 leading-relaxed whitespace-pre-wrap",children:r.content})})]})})]}),e.jsx(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1},children:e.jsx(le,{topic:r,posts:y,onLike:A,onDislike:k,onBookmark:h,onMarkSolution:b,onReply:B,onEdit:E,onDelete:L,onReport:z})})]})}):e.jsx(D,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Topic Not Found"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"The topic you're looking for doesn't exist."}),e.jsx(l,{onClick:()=>j("/forum"),children:"Back to Forum"})]})})};export{ye as default};
