import{j as e,ak as G,X as ve,a$ as be,i as we,au as xe,c as Ce,H as Se,F as K,U as ne,ap as V,B as De,O as ue,aC as he,M as ge,L as Ae,y as ke,g as ie,a6 as le,ae as de,o as fe,ag as pe,E as je,al as Ee,an as ae,aM as Ie,b0 as Le,b1 as Re,b2 as Te,K as Me,b3 as $e,k as Fe,z as Pe,am as Oe,b4 as ze,af as Be,b5 as Ye,b6 as Qe,ad as Ue}from"./vendor-ui-834bd4ab.js";import{r as n,u as ye,N as re,e as oe,L as R,O as qe,f as Ze,h as He,c as Ve,d as E}from"./vendor-react-fa5d0322.js";import{o as Ke,k as se,l as B,s as ee,m as We,T as Y,q as L,n as I,w as A,t as z,v as X,x as ce,y as Xe,z as _e,A as J,B as Ge,D as _,E as Je}from"./vendor-firebase-cb809cd2.js";import{d as b,c as W,s as es}from"./main-644effba.js";import"./vendor-helmet-7425e547.js";const Ne=n.createContext(void 0),Z=()=>{const r=n.useContext(Ne);if(!r)throw new Error("useAdminAuth must be used within AdminAuthProvider");return r},ss=({children:r})=>{const[p,i]=n.useState(null),[l,j]=n.useState(null),[c,C]=n.useState(!0);n.useEffect(()=>Ke(W,async D=>{if(D){j(D);try{const x=await se(B(b,"users",D.uid));if(x.exists()){const y=x.data();y.role==="expert"||y.role==="admin"?i({...y,id:D.uid}):(await ee(W),i(null),j(null))}}catch(x){console.error("Error fetching user data:",x),i(null)}}else i(null),j(null);C(!1)}),[]);const S=async(f,D)=>{try{const x=await We(W,f,D),y=await se(B(b,"users",x.user.uid));if(y.exists()){const t=y.data();if(t.role!=="expert"&&t.role!=="admin")throw await ee(W),new Error("Access denied. Only experts and admins can access this portal.")}else throw await ee(W),new Error("User data not found.")}catch(x){throw x.code==="auth/user-not-found"?new Error("No user found with this email address."):x.code==="auth/wrong-password"?new Error("Incorrect password."):x.code==="auth/invalid-email"?new Error("Invalid email address."):x}},h=async()=>{try{await ee(W)}catch(f){throw console.error("Error signing out:",f),f}},d=(p==null?void 0:p.role)==="expert",N=(p==null?void 0:p.role)==="admin",o={currentUser:p,firebaseUser:l,loading:c,login:S,logout:h,isExpert:d,isAdmin:N};return e.jsx(Ne.Provider,{value:o,children:r})},me=({children:r,requireAdmin:p=!1})=>{const{currentUser:i,loading:l,isAdmin:j}=Z(),c=ye();return l?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(G,{className:"h-8 w-8 animate-spin text-indigo-600"})}):i?p&&!j?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600",children:"This page is restricted to administrators only."})]})}):e.jsx(e.Fragment,{children:r}):e.jsx(re,{to:"/admin/login",state:{from:c},replace:!0})},ts=()=>{var N;const{currentUser:r,logout:p,isAdmin:i}=Z(),l=ye(),j=oe(),[c,C]=n.useState(!1),S=async()=>{try{await p(),j("/admin/login")}catch(o){console.error("Error logging out:",o)}},h=[{name:"Dashboard",href:"/admin/dashboard",icon:Se},{name:"Documents",href:"/admin/documents",icon:K},{name:"Customers",href:"/admin/customers",icon:ne},{name:"Messages",href:"/admin/messages",icon:V},{name:"Analytics",href:"/admin/analytics",icon:De}];i&&h.push({name:"Assignments",href:"/admin/assignments",icon:ue});const d=o=>l.pathname===o;return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:`fixed inset-0 flex z-40 lg:hidden ${c?"":"pointer-events-none"}`,children:[e.jsx("div",{className:`fixed inset-0 bg-gray-600 bg-opacity-75 transition-opacity ${c?"opacity-100":"opacity-0"}`,onClick:()=>C(!1)}),e.jsxs("div",{className:`relative flex-1 flex flex-col max-w-xs w-full bg-white transform transition-transform ${c?"translate-x-0":"-translate-x-full"}`,children:[e.jsx("div",{className:"absolute top-0 right-0 -mr-12 pt-2",children:e.jsx("button",{className:"ml-1 flex items-center justify-center h-10 w-10 rounded-full focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white",onClick:()=>C(!1),children:e.jsx(ve,{className:"h-6 w-6 text-white"})})}),e.jsxs("div",{className:"flex-1 h-0 pt-5 pb-4 overflow-y-auto",children:[e.jsx("div",{className:"flex-shrink-0 flex items-center px-4",children:e.jsx("h2",{className:"text-2xl font-bold text-indigo-600",children:"Tax Admin"})}),e.jsx("nav",{className:"mt-5 px-2 space-y-1",children:h.map(o=>{const f=o.icon;return e.jsxs(R,{to:o.href,className:`group flex items-center px-2 py-2 text-base font-medium rounded-md ${d(o.href)?"bg-indigo-50 text-indigo-700":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"}`,children:[e.jsx(f,{className:"mr-4 h-6 w-6"}),o.name]},o.name)})})]}),e.jsx("div",{className:"flex-shrink-0 flex border-t border-gray-200 p-4",children:e.jsx("div",{className:"flex-shrink-0 group block",children:e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-base font-medium text-gray-700",children:r==null?void 0:r.name}),e.jsx("p",{className:"text-sm font-medium text-gray-500 capitalize",children:r==null?void 0:r.role})]})})})})]})]}),e.jsx("div",{className:"hidden lg:flex lg:w-64 lg:flex-col lg:fixed lg:inset-y-0",children:e.jsxs("div",{className:"flex-1 flex flex-col min-h-0 bg-white border-r border-gray-200",children:[e.jsxs("div",{className:"flex-1 flex flex-col pt-5 pb-4 overflow-y-auto",children:[e.jsx("div",{className:"flex items-center flex-shrink-0 px-4",children:e.jsx("h2",{className:"text-2xl font-bold text-indigo-600",children:"Tax Admin Portal"})}),e.jsx("nav",{className:"mt-5 flex-1 px-2 space-y-1",children:h.map(o=>{const f=o.icon;return e.jsxs(R,{to:o.href,className:`group flex items-center px-2 py-2 text-sm font-medium rounded-md ${d(o.href)?"bg-indigo-50 text-indigo-700":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"}`,children:[e.jsx(f,{className:"mr-3 h-5 w-5"}),o.name]},o.name)})})]}),e.jsx("div",{className:"flex-shrink-0 flex border-t border-gray-200 p-4",children:e.jsx("div",{className:"flex-shrink-0 w-full group block",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:r==null?void 0:r.name}),e.jsx("p",{className:"text-xs font-medium text-gray-500 capitalize",children:r==null?void 0:r.role})]}),e.jsx("button",{onClick:S,className:"p-2 rounded-md hover:bg-gray-100 transition-colors",title:"Logout",children:e.jsx(be,{className:"h-5 w-5 text-gray-500"})})]})})})]})}),e.jsxs("div",{className:"lg:pl-64 flex flex-col flex-1",children:[e.jsx("div",{className:"sticky top-0 z-10 lg:hidden pl-1 pt-1 sm:pl-3 sm:pt-3 bg-white shadow",children:e.jsx("button",{className:"-ml-0.5 -mt-0.5 h-12 w-12 inline-flex items-center justify-center rounded-md text-gray-500 hover:text-gray-900 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500",onClick:()=>C(!0),children:e.jsx(we,{className:"h-6 w-6"})})}),e.jsx("div",{className:"hidden lg:block bg-white shadow-sm",children:e.jsx("div",{className:"px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center py-4",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:((N=h.find(o=>d(o.href)))==null?void 0:N.name)||"Dashboard"})}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("button",{className:"p-2 rounded-md hover:bg-gray-100 relative",children:[e.jsx(xe,{className:"h-5 w-5 text-gray-600"}),e.jsx("span",{className:"absolute top-1 right-1 block h-2 w-2 rounded-full bg-red-500 ring-2 ring-white"})]}),e.jsx(R,{to:"/admin/settings",className:"p-2 rounded-md hover:bg-gray-100",children:e.jsx(Ce,{className:"h-5 w-5 text-gray-600"})})]})]})})}),e.jsx("main",{className:"flex-1",children:e.jsx("div",{className:"py-6 px-4 sm:px-6 lg:px-8",children:e.jsx(qe,{})})})]})]})},as=()=>{const[r,p]=n.useState(""),[i,l]=n.useState(""),[j,c]=n.useState(""),[C,S]=n.useState(!1),{login:h}=Z(),d=oe(),N=async o=>{o.preventDefault(),c(""),S(!0);try{await h(r,i),d("/admin/dashboard")}catch(f){c(f.message||"Failed to log in. Please try again.")}finally{S(!1)}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-md w-full space-y-8 bg-white p-8 rounded-2xl shadow-xl",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"mt-6 text-center text-3xl font-bold text-gray-900",children:"Tax Expert Portal"}),e.jsx("p",{className:"mt-2 text-center text-sm text-gray-600",children:"Sign in to access the admin dashboard"})]}),e.jsxs("form",{className:"mt-8 space-y-6",onSubmit:N,children:[j&&e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg flex items-center",children:[e.jsx(he,{className:"h-5 w-5 mr-2"}),e.jsx("span",{className:"text-sm",children:j})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email address"}),e.jsxs("div",{className:"mt-1 relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(ge,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,value:r,onChange:o=>p(o.target.value),className:"appearance-none block w-full pl-10 px-3 py-2 border border-gray-300 rounded-lg shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"expert@taxed.ch"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Password"}),e.jsxs("div",{className:"mt-1 relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(Ae,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,value:i,onChange:o=>l(o.target.value),className:"appearance-none block w-full pl-10 px-3 py-2 border border-gray-300 rounded-lg shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"Enter your password"})]})]})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:C,className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-lg text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",children:C?e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"animate-spin h-5 w-5 mr-2"}),"Signing in..."]}):"Sign in"})}),e.jsx("div",{className:"text-sm text-center",children:e.jsx("p",{className:"text-gray-600",children:"Access restricted to tax experts and administrators only"})})]})]})})},rs=()=>{const{currentUser:r,isAdmin:p}=Z(),[i,l]=n.useState({totalCustomers:0,pendingDocuments:0,reviewedToday:0,reviewedThisWeek:0,reviewedThisMonth:0,unreadMessages:0}),[j,c]=n.useState([]),[C,S]=n.useState(!0);n.useEffect(()=>{if(!r)return;const d=[];return(async()=>{try{if(r.role==="expert"){const x=L(I(b,"users"),A("assignedExpertId","==",r.id));d.push(z(x,y=>{l(t=>({...t,totalCustomers:y.size}))}))}else{const x=L(I(b,"users"),A("role","==","customer"));d.push(z(x,y=>{l(t=>({...t,totalCustomers:y.size}))}))}let o;r.role==="expert"?o=L(I(b,"documents"),A("expertId","==",r.id),A("status","==","pending")):o=L(I(b,"documents"),A("status","==","pending")),d.push(z(o,x=>{l(y=>({...y,pendingDocuments:x.size}))}));const f=L(I(b,"conversations"),A("expertId","==",r.id),A("unreadCountExpert",">",0));d.push(z(f,x=>{const y=x.docs.reduce((t,g)=>t+(g.data().unreadCountExpert||0),0);l(t=>({...t,unreadMessages:y}))}));let D;r.role==="expert"?D=L(I(b,"documents"),A("expertId","==",r.id),X("uploadedAt","desc"),ce(5)):D=L(I(b,"documents"),X("uploadedAt","desc"),ce(5)),d.push(z(D,x=>{const y=x.docs.map(t=>({id:t.id,...t.data()}));c(y)})),S(!1)}catch(o){console.error("Error loading dashboard stats:",o),S(!1)}})(),()=>{d.forEach(o=>o())}},[r,p]);const h=d=>{switch(d){case"approved":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";case"pending":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}};return C?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900",children:["Welcome back, ",r==null?void 0:r.name,"!"]}),e.jsx("p",{className:"mt-1 text-gray-600",children:"Here's an overview of your tax consultation workspace"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsxs("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:[e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(ne,{className:"h-6 w-6 text-gray-400"})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Total Customers"}),e.jsx("dd",{className:"flex items-baseline",children:e.jsx("div",{className:"text-2xl font-semibold text-gray-900",children:i.totalCustomers})})]})})]})}),e.jsx("div",{className:"bg-gray-50 px-5 py-3",children:e.jsx("div",{className:"text-sm",children:e.jsx(R,{to:"/admin/customers",className:"font-medium text-indigo-600 hover:text-indigo-900",children:"View all"})})})]}),e.jsxs("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:[e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(K,{className:"h-6 w-6 text-yellow-400"})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Pending Documents"}),e.jsx("dd",{className:"flex items-baseline",children:e.jsx("div",{className:"text-2xl font-semibold text-gray-900",children:i.pendingDocuments})})]})})]})}),e.jsx("div",{className:"bg-gray-50 px-5 py-3",children:e.jsx("div",{className:"text-sm",children:e.jsx(R,{to:"/admin/documents",className:"font-medium text-indigo-600 hover:text-indigo-900",children:"Review now"})})})]}),e.jsxs("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:[e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(V,{className:"h-6 w-6 text-blue-400"})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Unread Messages"}),e.jsx("dd",{className:"flex items-baseline",children:e.jsx("div",{className:"text-2xl font-semibold text-gray-900",children:i.unreadMessages})})]})})]})}),e.jsx("div",{className:"bg-gray-50 px-5 py-3",children:e.jsx("div",{className:"text-sm",children:e.jsx(R,{to:"/admin/messages",className:"font-medium text-indigo-600 hover:text-indigo-900",children:"View messages"})})})]}),e.jsxs("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:[e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(ke,{className:"h-6 w-6 text-green-400"})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Reviewed Today"}),e.jsx("dd",{className:"flex items-baseline",children:e.jsx("div",{className:"text-2xl font-semibold text-gray-900",children:i.reviewedToday})})]})})]})}),e.jsx("div",{className:"bg-gray-50 px-5 py-3",children:e.jsx("div",{className:"text-sm",children:e.jsx(R,{to:"/admin/analytics",className:"font-medium text-indigo-600 hover:text-indigo-900",children:"View analytics"})})})]})]}),e.jsxs("div",{className:"bg-white shadow rounded-lg",children:[e.jsxs("div",{className:"px-4 py-5 sm:px-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Recent Documents"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Latest uploaded documents requiring review"})]}),e.jsx("div",{className:"overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Document"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Customer"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Category"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Uploaded"}),e.jsx("th",{className:"relative px-6 py-3",children:e.jsx("span",{className:"sr-only",children:"Actions"})})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:j.length>0?j.map(d=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(K,{className:"h-5 w-5 text-gray-400 mr-3"}),e.jsx("div",{className:"text-sm font-medium text-gray-900",children:d.fileName})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:d.customerId}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 capitalize",children:d.category}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${h(d.status)}`,children:d.status})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:d.uploadedAt instanceof Y?new Date(d.uploadedAt.toDate()).toLocaleDateString():new Date(d.uploadedAt).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsx(R,{to:`/admin/documents/${d.id}`,className:"text-indigo-600 hover:text-indigo-900",children:"Review"})})]},d.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-12 text-center text-gray-500",children:"No recent documents found"})})})]})})]})]})},ns=()=>{const{currentUser:r,isAdmin:p}=Z(),[i,l]=n.useState([]),[j,c]=n.useState([]),[C,S]=n.useState(!0),[h,d]=n.useState(""),[N,o]=n.useState("all"),[f,D]=n.useState("all"),[x,y]=n.useState("all"),[t,g]=n.useState("date"),[k,T]=n.useState("desc");n.useEffect(()=>{if(!r)return;const a=[];r.role==="expert"&&a.push(A("expertId","==",r.id)),N!=="all"&&a.push(A("status","==",N)),f!=="all"&&a.push(A("category","==",f)),x!=="all"&&a.push(A("taxYear","==",x)),a.push(X("uploadedAt","desc"));const w=L(I(b,"documents"),...a),m=z(w,s=>{const u=s.docs.map(v=>({id:v.id,...v.data()}));l(u),S(!1)},s=>{console.error("Error fetching documents:",s),S(!1)});return()=>m()},[r,N,f,x]),n.useEffect(()=>{let a=[...i];h&&(a=a.filter(w=>w.fileName.toLowerCase().includes(h.toLowerCase())||w.customerId.toLowerCase().includes(h.toLowerCase()))),a.sort((w,m)=>{let s=0;switch(t){case"date":const u=w.uploadedAt instanceof Y?w.uploadedAt.toDate():new Date(w.uploadedAt),v=m.uploadedAt instanceof Y?m.uploadedAt.toDate():new Date(m.uploadedAt);s=u.getTime()-v.getTime();break;case"customer":s=w.customerId.localeCompare(m.customerId);break;case"status":s=w.status.localeCompare(m.status);break}return k==="asc"?s:-s}),c(a)},[i,h,t,k]);const H=a=>{switch(a){case"approved":return e.jsx(je,{className:"h-5 w-5 text-green-500"});case"rejected":return e.jsx(pe,{className:"h-5 w-5 text-red-500"});case"pending":return e.jsx(fe,{className:"h-5 w-5 text-yellow-500"});default:return e.jsx(de,{className:"h-5 w-5 text-blue-500"})}},M=a=>{switch(a){case"approved":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";case"pending":return"bg-yellow-100 text-yellow-800";default:return"bg-blue-100 text-blue-800"}},Q=a=>({income:"bg-blue-100 text-blue-800",expense:"bg-purple-100 text-purple-800",investment:"bg-indigo-100 text-indigo-800",property:"bg-green-100 text-green-800",insurance:"bg-pink-100 text-pink-800",other:"bg-gray-100 text-gray-800"})[a]||"bg-gray-100 text-gray-800",$=new Date().getFullYear(),U=Array.from({length:5},(a,w)=>$-w);return C?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Document Review Queue"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Review and manage customer tax documents"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(ie,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"Search by filename or customer...",value:h,onChange:a=>d(a.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{className:"block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",value:N,onChange:a=>o(a.target.value),children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"reviewed",children:"Reviewed"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"rejected",children:"Rejected"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category"}),e.jsxs("select",{className:"block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",value:f,onChange:a=>D(a.target.value),children:[e.jsx("option",{value:"all",children:"All Categories"}),e.jsx("option",{value:"income",children:"Income"}),e.jsx("option",{value:"expense",children:"Expense"}),e.jsx("option",{value:"investment",children:"Investment"}),e.jsx("option",{value:"property",children:"Property"}),e.jsx("option",{value:"insurance",children:"Insurance"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tax Year"}),e.jsxs("select",{className:"block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",value:x,onChange:a=>y(a.target.value==="all"?"all":parseInt(a.target.value)),children:[e.jsx("option",{value:"all",children:"All Years"}),U.map(a=>e.jsx("option",{value:a,children:a},a))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Sort By"}),e.jsxs("select",{className:"block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",value:t,onChange:a=>g(a.target.value),children:[e.jsx("option",{value:"date",children:"Upload Date"}),e.jsx("option",{value:"customer",children:"Customer"}),e.jsx("option",{value:"status",children:"Status"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Order"}),e.jsxs("select",{className:"block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",value:k,onChange:a=>T(a.target.value),children:[e.jsx("option",{value:"desc",children:"Newest First"}),e.jsx("option",{value:"asc",children:"Oldest First"})]})]})]})]}),e.jsxs("div",{className:"mt-4 text-sm text-gray-500",children:["Showing ",j.length," of ",i.length," documents"]})]}),e.jsx("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Document"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Customer"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Category"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tax Year"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"AI Confidence"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Uploaded"}),e.jsx("th",{className:"relative px-6 py-3",children:e.jsx("span",{className:"sr-only",children:"Actions"})})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:j.length>0?j.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(K,{className:"h-5 w-5 text-gray-400 mr-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:a.fileName}),a.amount&&e.jsxs("div",{className:"text-sm text-gray-500",children:["CHF ",a.amount.toLocaleString()]})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:a.customerId})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${Q(a.category)}`,children:a.category})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:a.taxYear}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[H(a.status),e.jsx("span",{className:`ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${M(a.status)}`,children:a.status})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.aiConfidence&&e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2 mr-2",children:e.jsx("div",{className:`h-2 rounded-full ${a.aiConfidence>.8?"bg-green-500":a.aiConfidence>.5?"bg-yellow-500":"bg-red-500"}`,style:{width:`${a.aiConfidence*100}%`}})}),e.jsxs("span",{className:"text-sm text-gray-600",children:[Math.round(a.aiConfidence*100),"%"]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(le,{className:"h-4 w-4 mr-1"}),a.uploadedAt instanceof Y?new Date(a.uploadedAt.toDate()).toLocaleDateString():new Date(a.uploadedAt).toLocaleDateString()]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs(R,{to:`/admin/documents/${a.id}`,className:"text-indigo-600 hover:text-indigo-900 inline-flex items-center",children:[e.jsx(de,{className:"h-4 w-4 mr-1"}),"Review"]})})]},a.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"px-6 py-12 text-center text-gray-500",children:"No documents found matching your filters"})})})]})})})]})},is=()=>{const{id:r}=Ze(),p=oe(),{currentUser:i}=Z(),[l,j]=n.useState(null),[c,C]=n.useState(""),[S,h]=n.useState(!0),[d,N]=n.useState(!1),[o,f]=n.useState(""),[D,x]=n.useState(1),[y,t]=n.useState(0),[g,k]=n.useState({action:"approved",show:!1});n.useEffect(()=>{T()},[r]);const T=async()=>{if(r)try{const m=B(b,"documents",r),s=await se(m);if(s.exists()){const u={id:s.id,...s.data()};if(j(u),f(u.expertNotes||""),u.customerId&&u.fileName){const v=Xe(es,`documents/${u.customerId}/${u.fileName}`),F=await _e(v);C(F)}}else console.error("Document not found"),p("/admin/documents")}catch(m){console.error("Error loading document:",m)}finally{h(!1)}},H=async m=>{if(!(!l||!r)){N(!0);try{const s=B(b,"documents",r);await J(s,{status:m,expertNotes:o,reviewedAt:Y.now(),updatedAt:Y.now(),reviewedBy:i==null?void 0:i.id}),j({...l,status:m,expertNotes:o,reviewedAt:new Date,updatedAt:new Date}),k({action:m,show:!1}),setTimeout(()=>{p("/admin/documents")},1e3)}catch(s){console.error("Error updating document:",s)}finally{N(!1)}}},M=async()=>{if(!(!l||!r)){N(!0);try{const m=B(b,"documents",r);await J(m,{expertNotes:o,updatedAt:Y.now()}),j({...l,expertNotes:o,updatedAt:new Date})}catch(m){console.error("Error saving notes:",m)}finally{N(!1)}}},Q=()=>x(m=>Math.min(m+.25,3)),$=()=>x(m=>Math.max(m-.25,.5)),U=()=>t(m=>(m+90)%360),a=m=>{switch(m){case"approved":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";case"pending":return"bg-yellow-100 text-yellow-800";default:return"bg-blue-100 text-blue-800"}},w=m=>m?m>.8?"text-green-600":m>.5?"text-yellow-600":"text-red-600":"text-gray-500";return S?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx(G,{className:"h-8 w-8 animate-spin text-indigo-600"})}):l?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("button",{onClick:()=>p("/admin/documents"),className:"flex items-center text-gray-600 hover:text-gray-900",children:[e.jsx(Ee,{className:"h-5 w-5 mr-2"}),"Back to Documents"]}),e.jsx("div",{className:"flex items-center space-x-3",children:e.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${a(l.status)}`,children:l.status})})]}),e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[e.jsx(K,{className:"h-6 w-6 mr-3 text-gray-400"}),l.fileName]}),e.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Customer: ",l.customerId]}),e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),"Tax Year: ",l.taxYear]}),e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(Ie,{className:"h-4 w-4 mr-2"}),"Category: ",e.jsx("span",{className:"ml-1 capitalize",children:l.category})]}),e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(fe,{className:"h-4 w-4 mr-2"}),"Uploaded: ",l.uploadedAt instanceof Y?new Date(l.uploadedAt.toDate()).toLocaleString():new Date(l.uploadedAt).toLocaleString()]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Document Preview"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:$,className:"p-2 hover:bg-gray-100 rounded-lg",title:"Zoom Out",children:e.jsx(Le,{className:"h-5 w-5 text-gray-600"})}),e.jsxs("span",{className:"text-sm text-gray-600",children:[Math.round(D*100),"%"]}),e.jsx("button",{onClick:Q,className:"p-2 hover:bg-gray-100 rounded-lg",title:"Zoom In",children:e.jsx(Re,{className:"h-5 w-5 text-gray-600"})}),e.jsx("button",{onClick:U,className:"p-2 hover:bg-gray-100 rounded-lg",title:"Rotate",children:e.jsx(Te,{className:"h-5 w-5 text-gray-600"})}),e.jsx("a",{href:c,download:l.fileName,className:"p-2 hover:bg-gray-100 rounded-lg",title:"Download",children:e.jsx(Me,{className:"h-5 w-5 text-gray-600"})})]})]}),e.jsx("div",{className:"border rounded-lg overflow-hidden bg-gray-50",style:{height:"600px"},children:c?e.jsx("div",{className:"w-full h-full overflow-auto flex items-center justify-center",children:e.jsx("img",{src:c,alt:l.fileName,className:"max-w-none transition-transform duration-200",style:{transform:`scale(${D}) rotate(${y}deg)`,transformOrigin:"center"}})}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx(K,{className:"h-12 w-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"No preview available"})]})})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"AI Analysis"}),e.jsxs("div",{className:"space-y-4",children:[l.aiConfidence&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Confidence Score"}),e.jsxs("span",{className:`text-sm font-semibold ${w(l.aiConfidence)}`,children:[Math.round(l.aiConfidence*100),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${l.aiConfidence>.8?"bg-green-500":l.aiConfidence>.5?"bg-yellow-500":"bg-red-500"}`,style:{width:`${l.aiConfidence*100}%`}})})]}),l.amount&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Detected Amount"}),e.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:["CHF ",l.amount.toLocaleString()]})]}),l.aiSummary&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 block mb-2",children:"AI Summary"}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-3",children:e.jsx("p",{className:"text-sm text-gray-600",children:l.aiSummary})})]})]})]}),e.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Expert Notes"}),e.jsxs("button",{onClick:M,disabled:d,className:"inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50",children:[d?e.jsx(G,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx($e,{className:"h-4 w-4 mr-2"}),"Save Notes"]})]}),e.jsx("textarea",{value:o,onChange:m=>f(m.target.value),className:"w-full h-32 px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"Add your review notes here..."})]}),e.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Actions"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>k({action:"approved",show:!0}),disabled:d||l.status==="approved",className:"w-full inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50",children:[e.jsx(je,{className:"h-5 w-5 mr-2"}),"Approve Document"]}),e.jsxs("button",{onClick:()=>k({action:"rejected",show:!0}),disabled:d||l.status==="rejected",className:"w-full inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50",children:[e.jsx(pe,{className:"h-5 w-5 mr-2"}),"Reject Document"]}),e.jsxs("button",{onClick:()=>p(`/admin/messages?customerId=${l.customerId}`),className:"w-full inline-flex items-center justify-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[e.jsx(V,{className:"h-5 w-5 mr-2"}),"Request More Information"]})]})]})]})]}),g.show&&e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:["Confirm ",g.action==="approved"?"Approval":"Rejection"]}),e.jsxs("p",{className:"text-sm text-gray-500 mb-6",children:["Are you sure you want to ",g.action==="approved"?"approve":"reject"," this document? This action will update the document status and notify the customer."]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>k({...g,show:!1}),className:"px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{onClick:()=>H(g.action),className:`px-4 py-2 text-sm font-medium rounded-md text-white ${g.action==="approved"?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700"}`,children:d?e.jsx(G,{className:"h-4 w-4 animate-spin"}):"Confirm"})]})]})})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(he,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Document not found"})]})},ls=()=>{const{currentUser:r,isAdmin:p}=Z(),[i,l]=n.useState([]),[j,c]=n.useState([]),[C,S]=n.useState(!0),[h,d]=n.useState(""),[N,o]=n.useState("all"),[f,D]=n.useState("all");n.useEffect(()=>{if(!r)return;(async()=>{try{const g=[A("role","==","customer"),X("name")];r.role==="expert"&&g.push(A("assignedExpertId","==",r.id));const k=L(I(b,"users"),...g),T=z(k,async H=>{const M=[];for(const Q of H.docs){const $={id:Q.id,...Q.data()},U=L(I(b,"documents"),A("customerId","==",$.id)),a=await Ge(U);let w=0,m=0,s=$.updatedAt;a.forEach(u=>{var F;const v=u.data();v.status==="pending"?w++:v.status==="approved"&&m++,(F=v.uploadedAt)!=null&&F.toDate&&(!s||v.uploadedAt.toDate()>s)&&(s=v.uploadedAt.toDate())}),M.push({...$,documentCount:a.size,pendingDocuments:w,completedDocuments:m,lastActivity:s})}l(M),S(!1)});return()=>T()}catch(g){console.error("Error loading customers:",g),S(!1)}})()},[r,p]),n.useEffect(()=>{let t=[...i];h&&(t=t.filter(g=>{var k,T;return g.name.toLowerCase().includes(h.toLowerCase())||g.email.toLowerCase().includes(h.toLowerCase())||((k=g.canton)==null?void 0:k.toLowerCase().includes(h.toLowerCase()))||((T=g.municipality)==null?void 0:T.toLowerCase().includes(h.toLowerCase()))})),N!=="all"&&(t=t.filter(g=>g.canton===N)),f==="active"?t=t.filter(g=>g.pendingDocuments>0):f==="inactive"&&(t=t.filter(g=>g.pendingDocuments===0)),c(t)},[i,h,N,f]);const x=Array.from(new Set(i.map(t=>t.canton).filter(Boolean))).sort(),y=t=>t.documentCount===0?0:Math.round(t.completedDocuments/t.documentCount*100);return C?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Customer Management"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Manage and view all customer profiles and their documents"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(ie,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"Search by name, email, canton, or municipality...",value:h,onChange:t=>d(t.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{className:"block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",value:f,onChange:t=>D(t.target.value),children:[e.jsx("option",{value:"all",children:"All Customers"}),e.jsx("option",{value:"active",children:"Active (Pending Docs)"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Canton"}),e.jsxs("select",{className:"block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",value:N,onChange:t=>o(t.target.value),children:[e.jsx("option",{value:"all",children:"All Cantons"}),x.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:j.length})," of"," ",e.jsx("span",{className:"font-medium",children:i.length})," customers"]})})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2",children:j.length>0?j.map(t=>e.jsx("div",{className:"bg-white shadow rounded-lg hover:shadow-lg transition-shadow",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-12 w-12 rounded-full bg-indigo-100 flex items-center justify-center",children:e.jsx("span",{className:"text-indigo-600 font-medium text-lg",children:t.name.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:t.name}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500 mt-1",children:[e.jsx(ge,{className:"h-4 w-4 mr-1"}),t.email]})]})]}),t.assignedExpertId&&e.jsxs("div",{className:"flex items-center text-sm text-green-600",children:[e.jsx(ue,{className:"h-4 w-4 mr-1"}),"Assigned"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4 text-sm",children:[t.canton&&e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),t.canton,", ",t.municipality]}),t.lastActivity&&e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),"Last active: ",new Date(t.lastActivity).toLocaleDateString()]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Total Docs"}),e.jsx("div",{className:"text-xl font-semibold text-gray-900",children:t.documentCount})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Pending"}),e.jsx("div",{className:"text-xl font-semibold text-yellow-600",children:t.pendingDocuments})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Completed"}),e.jsx("div",{className:"text-xl font-semibold text-green-600",children:t.completedDocuments})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Completion"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[y(t),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-indigo-600 h-2 rounded-full",style:{width:`${y(t)}%`}})})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs(R,{to:`/admin/customers/${t.id}`,className:"flex-1 inline-flex items-center justify-center px-3 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:["View Profile",e.jsx(Pe,{className:"h-4 w-4 ml-1"})]}),e.jsxs(R,{to:`/admin/documents?customer=${t.id}`,className:"flex-1 inline-flex items-center justify-center px-3 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[e.jsx(K,{className:"h-4 w-4 mr-1"}),"Documents"]}),e.jsxs(R,{to:`/admin/messages?customerId=${t.id}`,className:"flex-1 inline-flex items-center justify-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[e.jsx(V,{className:"h-4 w-4 mr-1"}),"Message"]})]})]})]})},t.id)):e.jsxs("div",{className:"col-span-2 text-center py-12",children:[e.jsx(ne,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No customers found matching your filters"})]})})]})},os=()=>{var w,m;const[r]=He(),p=r.get("customerId"),{currentUser:i}=Z(),[l,j]=n.useState([]),[c,C]=n.useState(null),[S,h]=n.useState([]),[d,N]=n.useState(""),[o,f]=n.useState(""),[D,x]=n.useState(!0),[y,t]=n.useState(!1),g=n.useRef(null),k=n.useRef(null);n.useEffect(()=>{if(!i)return;(async()=>{try{const u=L(I(b,"conversations"),A("expertId","==",i.id),X("updatedAt","desc")),v=z(u,async F=>{const q=[];for(const P of F.docs){const O={id:P.id,...P.data()},te=await se(B(b,"users",O.customerId));te.exists()?q.push({...O,customerData:{id:te.id,...te.data()}}):q.push(O)}if(j(q),p&&!c){const P=q.find(O=>O.customerId===p);P&&C(P)}x(!1)});return()=>v()}catch(u){console.error("Error loading conversations:",u),x(!1)}})()},[i,p,c]),n.useEffect(()=>{if(!c){h([]);return}const s=L(I(b,"messages"),A("conversationId","==",c.id),X("sentAt","asc")),u=z(s,async v=>{const F=[],q=[];for(const P of v.docs){const O={id:P.id,...P.data()};F.push(O),O.senderRole==="customer"&&!O.isRead&&q.push(P.id)}h(F),q.length>0&&(T(q),H()),setTimeout(()=>$(),100)});return()=>u()},[c]);const T=async s=>{try{const u=s.map(v=>J(B(b,"messages",v),{isRead:!0,readAt:_()}));await Promise.all(u)}catch(u){console.error("Error marking messages as read:",u)}},H=async()=>{if(c)try{await J(B(b,"conversations",c.id),{unreadCountExpert:0,updatedAt:_()})}catch(s){console.error("Error updating conversation unread count:",s)}},M=async()=>{var s;if(!(!d.trim()||!c||!i)){t(!0);try{await Je(I(b,"messages"),{conversationId:c.id,senderId:i.id,senderRole:i.role,senderName:i.name,content:d,isRead:!1,sentAt:_()}),await J(B(b,"conversations",c.id),{lastMessage:d,lastMessageTime:_(),unreadCountCustomer:(c.unreadCountCustomer||0)+1,updatedAt:_()}),N(""),(s=k.current)==null||s.focus()}catch(u){console.error("Error sending message:",u)}finally{t(!1)}}},Q=s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),M())},$=()=>{var s;(s=g.current)==null||s.scrollIntoView({behavior:"smooth"})},U=s=>{if(!s)return"";const u=s instanceof Y?s.toDate():new Date(s),v=new Date;return u.toDateString()===v.toDateString()?u.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):u.toLocaleDateString("en-US",{month:"short",day:"numeric"})},a=l.filter(s=>{var u,v;return((u=s.customerData)==null?void 0:u.name.toLowerCase().includes(o.toLowerCase()))||((v=s.customerData)==null?void 0:v.email.toLowerCase().includes(o.toLowerCase()))});return D?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"})}):e.jsxs("div",{className:"bg-white rounded-lg shadow-lg h-[calc(100vh-180px)] flex",children:[e.jsxs("div",{className:`w-full lg:w-1/3 border-r border-gray-200 flex flex-col ${c?"hidden lg:flex":"flex"}`,children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(ie,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"Search conversations...",value:o,onChange:s=>f(s.target.value)})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:a.length>0?a.map(s=>{var u;return e.jsx("div",{onClick:()=>C(s),className:`p-4 border-b border-gray-100 hover:bg-gray-50 cursor-pointer transition-colors ${(c==null?void 0:c.id)===s.id?"bg-indigo-50":""}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center flex-1",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center",children:e.jsx(ae,{className:"h-6 w-6 text-gray-600"})}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:((u=s.customerData)==null?void 0:u.name)||"Unknown Customer"}),s.lastMessageTime&&e.jsx("p",{className:"text-xs text-gray-500",children:U(s.lastMessageTime)})]}),e.jsx("p",{className:"text-sm text-gray-500 truncate",children:s.lastMessage||"No messages yet"})]})]}),s.unreadCountExpert>0&&e.jsx("span",{className:"ml-2 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-white bg-red-500 rounded-full",children:s.unreadCountExpert})]})},s.id)}):e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx(V,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No conversations found"})]})})]}),e.jsx("div",{className:`flex-1 flex flex-col ${c?"flex":"hidden lg:flex"}`,children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-4 border-b border-gray-200 bg-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>C(null),className:"lg:hidden mr-3 p-2 rounded-md hover:bg-gray-100",children:e.jsx(Oe,{className:"h-5 w-5"})}),e.jsx("div",{className:"flex-shrink-0 h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center",children:e.jsx(ae,{className:"h-6 w-6 text-gray-600"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:((w=c.customerData)==null?void 0:w.name)||"Unknown Customer"}),e.jsx("p",{className:"text-xs text-gray-500",children:(m=c.customerData)==null?void 0:m.email})]})]}),e.jsx("button",{className:"p-2 rounded-md hover:bg-gray-100",children:e.jsx(xe,{className:"h-5 w-5 text-gray-600"})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 bg-gray-50",children:S.length>0?e.jsxs("div",{className:"space-y-4",children:[S.map(s=>e.jsx("div",{className:`flex ${s.senderRole===(i==null?void 0:i.role)?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${s.senderRole===(i==null?void 0:i.role)?"bg-indigo-600 text-white":"bg-white text-gray-900 shadow"}`,children:[e.jsx("p",{className:"text-sm",children:s.content}),e.jsxs("div",{className:`flex items-center justify-end mt-1 space-x-1 ${s.senderRole===(i==null?void 0:i.role)?"text-indigo-200":"text-gray-400"}`,children:[e.jsx("span",{className:"text-xs",children:U(s.sentAt)}),s.senderRole===(i==null?void 0:i.role)&&(s.isRead?e.jsx(ze,{className:"h-3 w-3"}):e.jsx(Be,{className:"h-3 w-3"}))]})]})},s.id)),e.jsx("div",{ref:g})]}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx(V,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-gray-500",children:"No messages yet. Start the conversation!"})]})})}),e.jsx("div",{className:"p-4 border-t border-gray-200 bg-white",children:e.jsxs("div",{className:"flex items-end space-x-2",children:[e.jsx("button",{className:"p-2 rounded-md hover:bg-gray-100",children:e.jsx(Ye,{className:"h-5 w-5 text-gray-600"})}),e.jsx("button",{className:"p-2 rounded-md hover:bg-gray-100",children:e.jsx(Qe,{className:"h-5 w-5 text-gray-600"})}),e.jsx("textarea",{ref:k,value:d,onChange:s=>N(s.target.value),onKeyPress:Q,placeholder:"Type your message...",className:"flex-1 resize-none border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",rows:1,disabled:y}),e.jsx("button",{onClick:M,disabled:!d.trim()||y,className:"p-2 rounded-lg bg-indigo-600 text-white hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:e.jsx(Ue,{className:"h-5 w-5"})})]})})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(V,{className:"h-16 w-16 mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-xl text-gray-500",children:"Select a conversation to start messaging"})]})})})]})},ds=()=>e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Analytics Dashboard"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Analytics features coming soon..."})]}),cs=()=>e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Assignment Management"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Manage customer-expert assignments"})]}),ms=()=>e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Customer Profile"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Detailed customer information"})]}),xs=()=>e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Settings"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Account and system settings"})]}),js=()=>e.jsx(ss,{children:e.jsxs(Ve,{children:[e.jsx(E,{path:"/login",element:e.jsx(as,{})}),e.jsxs(E,{element:e.jsx(me,{children:e.jsx(ts,{})}),children:[e.jsx(E,{index:!0,element:e.jsx(re,{to:"/admin/dashboard",replace:!0})}),e.jsx(E,{path:"/dashboard",element:e.jsx(rs,{})}),e.jsx(E,{path:"/documents",element:e.jsx(ns,{})}),e.jsx(E,{path:"/documents/:id",element:e.jsx(is,{})}),e.jsx(E,{path:"/customers",element:e.jsx(ls,{})}),e.jsx(E,{path:"/customers/:id",element:e.jsx(ms,{})}),e.jsx(E,{path:"/messages",element:e.jsx(os,{})}),e.jsx(E,{path:"/analytics",element:e.jsx(ds,{})}),e.jsx(E,{path:"/assignments",element:e.jsx(me,{requireAdmin:!0,children:e.jsx(cs,{})})}),e.jsx(E,{path:"/settings",element:e.jsx(xs,{})})]}),e.jsx(E,{path:"*",element:e.jsx(re,{to:"/admin/dashboard",replace:!0})})]})});export{js as default};
