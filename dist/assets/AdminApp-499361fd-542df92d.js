import{C as r,l as e,aW as Ne,aX as I,aY as te,aZ as ve,a_ as me,a8 as Q,a4 as re,Y as be,m as T,a$ as we,b0 as Ce,am as xe,ak as ke,b1 as Se,b2 as ue,W as he,q as Ae,b3 as $,b4 as E,b5 as w,b6 as A,b7 as F,b8 as J,b9 as de,J as ne,x as X,ag as H,$ as De,ba as q,av as le,u as ie,af as ce,a3 as Ie,bb as z,bc as se,bd as Ee,be as $e,bf as Te,a9 as Le,ac as ae,aH as Me,e as ge,bg as Re,bh as Ue,bi as Pe,g as Ye,bj as Fe,_ as pe,aa as fe,bk as qe,X as je,k as ze,Q as Ve,bl as Oe,ab as We,bm as Ze,aE as Be,bn as He,bo as Xe,ao as _e,bp as ee,bq as _,au as Je,p as Ke,br as G,bs as K,bt as Qe,bu as Ge}from"./main-3d4d0525.js";const ye=r.createContext(void 0),Z=()=>{const l=r.useContext(ye);if(!l)throw new Error("useAdminAuth must be used within AdminAuthProvider");return l},es=({children:l})=>{const[p,f]=r.useState(null),[n,d]=r.useState(null),[C,S]=r.useState(!0);r.useEffect(()=>ve(_,async x=>{if(x){d(x);try{const y=await se(z(w,"users",x.uid));if(y.exists()){const g=y.data();g.role==="expert"||g.role==="admin"?f({...g,id:x.uid}):(await ee(_),f(null),d(null))}}catch(y){console.error("Error fetching user data:",y),f(null)}}else f(null),d(null);S(!1)}),[]);const m=async(x,y)=>{try{const g=await Ge(_,x,y),b=await se(z(w,"users",g.user.uid));if(b.exists()){const t=b.data();if(t.role!=="expert"&&t.role!=="admin")throw await ee(_),new Error("Access denied. Only experts and admins can access this portal.")}else throw await ee(_),new Error("User data not found.")}catch(g){throw g.code==="auth/user-not-found"?new Error("No user found with this email address."):g.code==="auth/wrong-password"?new Error("Incorrect password."):g.code==="auth/invalid-email"?new Error("Invalid email address."):g}},j=async()=>{try{await ee(_)}catch(x){throw console.error("Error signing out:",x),x}},c=(p==null?void 0:p.role)==="expert",u=(p==null?void 0:p.role)==="admin",i={currentUser:p,firebaseUser:n,loading:C,login:m,logout:j,isExpert:c,isAdmin:u};return e.jsx(ye.Provider,{value:i,children:l})},oe=({children:l,requireAdmin:p=!1})=>{const{currentUser:f,loading:n,isAdmin:d}=Z(),C=me();return n?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(Q,{className:"h-8 w-8 animate-spin text-indigo-600"})}):f?p&&!d?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600",children:"This page is restricted to administrators only."})]})}):e.jsx(e.Fragment,{children:l}):e.jsx(te,{to:"/admin/login",state:{from:C},replace:!0})},ss=()=>{var l;const{currentUser:p,logout:f,isAdmin:n}=Z(),d=me(),C=re(),[S,m]=r.useState(!1),j=async()=>{try{await f(),C("/admin/login")}catch(i){console.error("Error logging out:",i)}},c=[{name:"Dashboard",href:"/admin/dashboard",icon:Je},{name:"Documents",href:"/admin/documents",icon:X},{name:"Customers",href:"/admin/customers",icon:ne},{name:"Messages",href:"/admin/messages",icon:H},{name:"Analytics",href:"/admin/analytics",icon:Ke}];n&&c.push({name:"Assignments",href:"/admin/assignments",icon:je});const u=i=>d.pathname===i;return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:`fixed inset-0 flex z-40 lg:hidden ${S?"":"pointer-events-none"}`,children:[e.jsx("div",{className:`fixed inset-0 bg-gray-600 bg-opacity-75 transition-opacity ${S?"opacity-100":"opacity-0"}`,onClick:()=>m(!1)}),e.jsxs("div",{className:`relative flex-1 flex flex-col max-w-xs w-full bg-white transform transition-transform ${S?"translate-x-0":"-translate-x-full"}`,children:[e.jsx("div",{className:"absolute top-0 right-0 -mr-12 pt-2",children:e.jsx("button",{className:"ml-1 flex items-center justify-center h-10 w-10 rounded-full focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white",onClick:()=>m(!1),children:e.jsx(be,{className:"h-6 w-6 text-white"})})}),e.jsxs("div",{className:"flex-1 h-0 pt-5 pb-4 overflow-y-auto",children:[e.jsx("div",{className:"flex-shrink-0 flex items-center px-4",children:e.jsx("h2",{className:"text-2xl font-bold text-indigo-600",children:"Tax Admin"})}),e.jsx("nav",{className:"mt-5 px-2 space-y-1",children:c.map(i=>{const x=i.icon;return e.jsxs(T,{to:i.href,className:`group flex items-center px-2 py-2 text-base font-medium rounded-md ${u(i.href)?"bg-indigo-50 text-indigo-700":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"}`,children:[e.jsx(x,{className:"mr-4 h-6 w-6"}),i.name]},i.name)})})]}),e.jsx("div",{className:"flex-shrink-0 flex border-t border-gray-200 p-4",children:e.jsx("div",{className:"flex-shrink-0 group block",children:e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-base font-medium text-gray-700",children:p==null?void 0:p.name}),e.jsx("p",{className:"text-sm font-medium text-gray-500 capitalize",children:p==null?void 0:p.role})]})})})})]})]}),e.jsx("div",{className:"hidden lg:flex lg:w-64 lg:flex-col lg:fixed lg:inset-y-0",children:e.jsxs("div",{className:"flex-1 flex flex-col min-h-0 bg-white border-r border-gray-200",children:[e.jsxs("div",{className:"flex-1 flex flex-col pt-5 pb-4 overflow-y-auto",children:[e.jsx("div",{className:"flex items-center flex-shrink-0 px-4",children:e.jsx("h2",{className:"text-2xl font-bold text-indigo-600",children:"Tax Admin Portal"})}),e.jsx("nav",{className:"mt-5 flex-1 px-2 space-y-1",children:c.map(i=>{const x=i.icon;return e.jsxs(T,{to:i.href,className:`group flex items-center px-2 py-2 text-sm font-medium rounded-md ${u(i.href)?"bg-indigo-50 text-indigo-700":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"}`,children:[e.jsx(x,{className:"mr-3 h-5 w-5"}),i.name]},i.name)})})]}),e.jsx("div",{className:"flex-shrink-0 flex border-t border-gray-200 p-4",children:e.jsx("div",{className:"flex-shrink-0 w-full group block",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:p==null?void 0:p.name}),e.jsx("p",{className:"text-xs font-medium text-gray-500 capitalize",children:p==null?void 0:p.role})]}),e.jsx("button",{onClick:j,className:"p-2 rounded-md hover:bg-gray-100 transition-colors",title:"Logout",children:e.jsx(we,{className:"h-5 w-5 text-gray-500"})})]})})})]})}),e.jsxs("div",{className:"lg:pl-64 flex flex-col flex-1",children:[e.jsx("div",{className:"sticky top-0 z-10 lg:hidden pl-1 pt-1 sm:pl-3 sm:pt-3 bg-white shadow",children:e.jsx("button",{className:"-ml-0.5 -mt-0.5 h-12 w-12 inline-flex items-center justify-center rounded-md text-gray-500 hover:text-gray-900 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500",onClick:()=>m(!0),children:e.jsx(Ce,{className:"h-6 w-6"})})}),e.jsx("div",{className:"hidden lg:block bg-white shadow-sm",children:e.jsx("div",{className:"px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center py-4",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:((l=c.find(i=>u(i.href)))==null?void 0:l.name)||"Dashboard"})}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("button",{className:"p-2 rounded-md hover:bg-gray-100 relative",children:[e.jsx(xe,{className:"h-5 w-5 text-gray-600"}),e.jsx("span",{className:"absolute top-1 right-1 block h-2 w-2 rounded-full bg-red-500 ring-2 ring-white"})]}),e.jsx(T,{to:"/admin/settings",className:"p-2 rounded-md hover:bg-gray-100",children:e.jsx(ke,{className:"h-5 w-5 text-gray-600"})})]})]})})}),e.jsx("main",{className:"flex-1",children:e.jsx("div",{className:"py-6 px-4 sm:px-6 lg:px-8",children:e.jsx(Se,{})})})]})]})},ts=()=>{const[l,p]=r.useState(""),[f,n]=r.useState(""),[d,C]=r.useState(""),[S,m]=r.useState(!1),{login:j}=Z(),c=re(),u=async i=>{i.preventDefault(),C(""),m(!0);try{await j(l,f),c("/admin/dashboard")}catch(x){C(x.message||"Failed to log in. Please try again.")}finally{m(!1)}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-md w-full space-y-8 bg-white p-8 rounded-2xl shadow-xl",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"mt-6 text-center text-3xl font-bold text-gray-900",children:"Tax Expert Portal"}),e.jsx("p",{className:"mt-2 text-center text-sm text-gray-600",children:"Sign in to access the admin dashboard"})]}),e.jsxs("form",{className:"mt-8 space-y-6",onSubmit:u,children:[d&&e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg flex items-center",children:[e.jsx(ue,{className:"h-5 w-5 mr-2"}),e.jsx("span",{className:"text-sm",children:d})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email address"}),e.jsxs("div",{className:"mt-1 relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(he,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,value:l,onChange:i=>p(i.target.value),className:"appearance-none block w-full pl-10 px-3 py-2 border border-gray-300 rounded-lg shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"expert@taxed.ch"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Password"}),e.jsxs("div",{className:"mt-1 relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(Ae,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,value:f,onChange:i=>n(i.target.value),className:"appearance-none block w-full pl-10 px-3 py-2 border border-gray-300 rounded-lg shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"Enter your password"})]})]})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:S,className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-lg text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",children:S?e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"animate-spin h-5 w-5 mr-2"}),"Signing in..."]}):"Sign in"})}),e.jsx("div",{className:"text-sm text-center",children:e.jsx("p",{className:"text-gray-600",children:"Access restricted to tax experts and administrators only"})})]})]})})},as=()=>{const{currentUser:l,isAdmin:p}=Z(),[f,n]=r.useState({totalCustomers:0,pendingDocuments:0,reviewedToday:0,reviewedThisWeek:0,reviewedThisMonth:0,unreadMessages:0}),[d,C]=r.useState([]),[S,m]=r.useState(!0);r.useEffect(()=>{if(!l)return;const c=[];return(async()=>{try{if(l.role==="expert"){const y=$(E(w,"users"),A("assignedExpertId","==",l.id));c.push(F(y,g=>{n(b=>({...b,totalCustomers:g.size}))}))}else{const y=$(E(w,"users"),A("role","==","customer"));c.push(F(y,g=>{n(b=>({...b,totalCustomers:g.size}))}))}let u;l.role==="expert"?u=$(E(w,"documents"),A("expertId","==",l.id),A("status","==","pending")):u=$(E(w,"documents"),A("status","==","pending")),c.push(F(u,y=>{n(g=>({...g,pendingDocuments:y.size}))}));const i=$(E(w,"conversations"),A("expertId","==",l.id),A("unreadCountExpert",">",0));c.push(F(i,y=>{const g=y.docs.reduce((b,t)=>b+(t.data().unreadCountExpert||0),0);n(b=>({...b,unreadMessages:g}))}));let x;l.role==="expert"?x=$(E(w,"documents"),A("expertId","==",l.id),J("uploadedAt","desc"),de(5)):x=$(E(w,"documents"),J("uploadedAt","desc"),de(5)),c.push(F(x,y=>{const g=y.docs.map(b=>({id:b.id,...b.data()}));C(g)})),m(!1)}catch(u){console.error("Error loading dashboard stats:",u),m(!1)}})(),()=>{c.forEach(u=>u())}},[l,p]);const j=c=>{switch(c){case"approved":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";case"pending":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}};return S?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900",children:["Welcome back, ",l==null?void 0:l.name,"!"]}),e.jsx("p",{className:"mt-1 text-gray-600",children:"Here's an overview of your tax consultation workspace"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsxs("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:[e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(ne,{className:"h-6 w-6 text-gray-400"})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Total Customers"}),e.jsx("dd",{className:"flex items-baseline",children:e.jsx("div",{className:"text-2xl font-semibold text-gray-900",children:f.totalCustomers})})]})})]})}),e.jsx("div",{className:"bg-gray-50 px-5 py-3",children:e.jsx("div",{className:"text-sm",children:e.jsx(T,{to:"/admin/customers",className:"font-medium text-indigo-600 hover:text-indigo-900",children:"View all"})})})]}),e.jsxs("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:[e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(X,{className:"h-6 w-6 text-yellow-400"})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Pending Documents"}),e.jsx("dd",{className:"flex items-baseline",children:e.jsx("div",{className:"text-2xl font-semibold text-gray-900",children:f.pendingDocuments})})]})})]})}),e.jsx("div",{className:"bg-gray-50 px-5 py-3",children:e.jsx("div",{className:"text-sm",children:e.jsx(T,{to:"/admin/documents",className:"font-medium text-indigo-600 hover:text-indigo-900",children:"Review now"})})})]}),e.jsxs("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:[e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(H,{className:"h-6 w-6 text-blue-400"})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Unread Messages"}),e.jsx("dd",{className:"flex items-baseline",children:e.jsx("div",{className:"text-2xl font-semibold text-gray-900",children:f.unreadMessages})})]})})]})}),e.jsx("div",{className:"bg-gray-50 px-5 py-3",children:e.jsx("div",{className:"text-sm",children:e.jsx(T,{to:"/admin/messages",className:"font-medium text-indigo-600 hover:text-indigo-900",children:"View messages"})})})]}),e.jsxs("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:[e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(De,{className:"h-6 w-6 text-green-400"})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Reviewed Today"}),e.jsx("dd",{className:"flex items-baseline",children:e.jsx("div",{className:"text-2xl font-semibold text-gray-900",children:f.reviewedToday})})]})})]})}),e.jsx("div",{className:"bg-gray-50 px-5 py-3",children:e.jsx("div",{className:"text-sm",children:e.jsx(T,{to:"/admin/analytics",className:"font-medium text-indigo-600 hover:text-indigo-900",children:"View analytics"})})})]})]}),e.jsxs("div",{className:"bg-white shadow rounded-lg",children:[e.jsxs("div",{className:"px-4 py-5 sm:px-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Recent Documents"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Latest uploaded documents requiring review"})]}),e.jsx("div",{className:"overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Document"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Customer"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Category"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Uploaded"}),e.jsx("th",{className:"relative px-6 py-3",children:e.jsx("span",{className:"sr-only",children:"Actions"})})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:d.length>0?d.map(c=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(X,{className:"h-5 w-5 text-gray-400 mr-3"}),e.jsx("div",{className:"text-sm font-medium text-gray-900",children:c.fileName})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:c.customerId}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 capitalize",children:c.category}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${j(c.status)}`,children:c.status})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:c.uploadedAt instanceof q?new Date(c.uploadedAt.toDate()).toLocaleDateString():new Date(c.uploadedAt).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsx(T,{to:`/admin/documents/${c.id}`,className:"text-indigo-600 hover:text-indigo-900",children:"Review"})})]},c.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-12 text-center text-gray-500",children:"No recent documents found"})})})]})})]})]})},rs=()=>{const{currentUser:l,isAdmin:p}=Z(),[f,n]=r.useState([]),[d,C]=r.useState([]),[S,m]=r.useState(!0),[j,c]=r.useState(""),[u,i]=r.useState("all"),[x,y]=r.useState("all"),[g,b]=r.useState("all"),[t,N]=r.useState("date"),[D,L]=r.useState("desc");r.useEffect(()=>{if(!l)return;const a=[];l.role==="expert"&&a.push(A("expertId","==",l.id)),u!=="all"&&a.push(A("status","==",u)),x!=="all"&&a.push(A("category","==",x)),g!=="all"&&a.push(A("taxYear","==",g)),a.push(J("uploadedAt","desc"));const k=$(E(w,"documents"),...a),o=F(k,s=>{const h=s.docs.map(v=>({id:v.id,...v.data()}));n(h),m(!1)},s=>{console.error("Error fetching documents:",s),m(!1)});return()=>o()},[l,u,x,g]),r.useEffect(()=>{let a=[...f];j&&(a=a.filter(k=>k.fileName.toLowerCase().includes(j.toLowerCase())||k.customerId.toLowerCase().includes(j.toLowerCase()))),a.sort((k,o)=>{let s=0;switch(t){case"date":const h=k.uploadedAt instanceof q?k.uploadedAt.toDate():new Date(k.uploadedAt),v=o.uploadedAt instanceof q?o.uploadedAt.toDate():new Date(o.uploadedAt);s=h.getTime()-v.getTime();break;case"customer":s=k.customerId.localeCompare(o.customerId);break;case"status":s=k.status.localeCompare(o.status);break}return D==="asc"?s:-s}),C(a)},[f,j,t,D]);const M=a=>{switch(a){case"approved":return e.jsx(pe,{className:"h-5 w-5 text-green-500"});case"rejected":return e.jsx(fe,{className:"h-5 w-5 text-red-500"});case"pending":return e.jsx(ge,{className:"h-5 w-5 text-yellow-500"});default:return e.jsx(ce,{className:"h-5 w-5 text-blue-500"})}},V=a=>{switch(a){case"approved":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";case"pending":return"bg-yellow-100 text-yellow-800";default:return"bg-blue-100 text-blue-800"}},R=a=>({income:"bg-blue-100 text-blue-800",expense:"bg-purple-100 text-purple-800",investment:"bg-indigo-100 text-indigo-800",property:"bg-green-100 text-green-800",insurance:"bg-pink-100 text-pink-800",other:"bg-gray-100 text-gray-800"})[a]||"bg-gray-100 text-gray-800",O=new Date().getFullYear(),W=Array.from({length:5},(a,k)=>O-k);return S?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Document Review Queue"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Review and manage customer tax documents"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(le,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"Search by filename or customer...",value:j,onChange:a=>c(a.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{className:"block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",value:u,onChange:a=>i(a.target.value),children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"reviewed",children:"Reviewed"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"rejected",children:"Rejected"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category"}),e.jsxs("select",{className:"block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",value:x,onChange:a=>y(a.target.value),children:[e.jsx("option",{value:"all",children:"All Categories"}),e.jsx("option",{value:"income",children:"Income"}),e.jsx("option",{value:"expense",children:"Expense"}),e.jsx("option",{value:"investment",children:"Investment"}),e.jsx("option",{value:"property",children:"Property"}),e.jsx("option",{value:"insurance",children:"Insurance"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tax Year"}),e.jsxs("select",{className:"block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",value:g,onChange:a=>b(a.target.value==="all"?"all":parseInt(a.target.value)),children:[e.jsx("option",{value:"all",children:"All Years"}),W.map(a=>e.jsx("option",{value:a,children:a},a))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Sort By"}),e.jsxs("select",{className:"block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",value:t,onChange:a=>N(a.target.value),children:[e.jsx("option",{value:"date",children:"Upload Date"}),e.jsx("option",{value:"customer",children:"Customer"}),e.jsx("option",{value:"status",children:"Status"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Order"}),e.jsxs("select",{className:"block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",value:D,onChange:a=>L(a.target.value),children:[e.jsx("option",{value:"desc",children:"Newest First"}),e.jsx("option",{value:"asc",children:"Oldest First"})]})]})]})]}),e.jsxs("div",{className:"mt-4 text-sm text-gray-500",children:["Showing ",d.length," of ",f.length," documents"]})]}),e.jsx("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Document"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Customer"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Category"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tax Year"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"AI Confidence"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Uploaded"}),e.jsx("th",{className:"relative px-6 py-3",children:e.jsx("span",{className:"sr-only",children:"Actions"})})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:d.length>0?d.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(X,{className:"h-5 w-5 text-gray-400 mr-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:a.fileName}),a.amount&&e.jsxs("div",{className:"text-sm text-gray-500",children:["CHF ",a.amount.toLocaleString()]})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:a.customerId})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${R(a.category)}`,children:a.category})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:a.taxYear}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[M(a.status),e.jsx("span",{className:`ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${V(a.status)}`,children:a.status})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.aiConfidence&&e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2 mr-2",children:e.jsx("div",{className:`h-2 rounded-full ${a.aiConfidence>.8?"bg-green-500":a.aiConfidence>.5?"bg-yellow-500":"bg-red-500"}`,style:{width:`${a.aiConfidence*100}%`}})}),e.jsxs("span",{className:"text-sm text-gray-600",children:[Math.round(a.aiConfidence*100),"%"]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ie,{className:"h-4 w-4 mr-1"}),a.uploadedAt instanceof q?new Date(a.uploadedAt.toDate()).toLocaleDateString():new Date(a.uploadedAt).toLocaleDateString()]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs(T,{to:`/admin/documents/${a.id}`,className:"text-indigo-600 hover:text-indigo-900 inline-flex items-center",children:[e.jsx(ce,{className:"h-4 w-4 mr-1"}),"Review"]})})]},a.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"px-6 py-12 text-center text-gray-500",children:"No documents found matching your filters"})})})]})})})]})},ns=()=>{const{id:l}=Ie(),p=re(),{currentUser:f}=Z(),[n,d]=r.useState(null),[C,S]=r.useState(""),[m,j]=r.useState(!0),[c,u]=r.useState(!1),[i,x]=r.useState(""),[y,g]=r.useState(1),[b,t]=r.useState(0),[N,D]=r.useState({action:"approved",show:!1});r.useEffect(()=>{L()},[l]);const L=async()=>{if(l)try{const o=z(w,"documents",l),s=await se(o);if(s.exists()){const h={id:s.id,...s.data()};if(d(h),x(h.expertNotes||""),h.customerId&&h.fileName){const v=Ee($e,`documents/${h.customerId}/${h.fileName}`),U=await Te(v);S(U)}}else console.error("Document not found"),p("/admin/documents")}catch(o){console.error("Error loading document:",o)}finally{j(!1)}},M=async o=>{if(!(!n||!l)){u(!0);try{const s=z(w,"documents",l);await G(s,{status:o,expertNotes:i,reviewedAt:q.now(),updatedAt:q.now(),reviewedBy:f==null?void 0:f.id}),d({...n,status:o,expertNotes:i,reviewedAt:new Date,updatedAt:new Date}),D({action:o,show:!1}),setTimeout(()=>{p("/admin/documents")},1e3)}catch(s){console.error("Error updating document:",s)}finally{u(!1)}}},V=async()=>{if(!(!n||!l)){u(!0);try{const o=z(w,"documents",l);await G(o,{expertNotes:i,updatedAt:q.now()}),d({...n,expertNotes:i,updatedAt:new Date})}catch(o){console.error("Error saving notes:",o)}finally{u(!1)}}},R=()=>g(o=>Math.min(o+.25,3)),O=()=>g(o=>Math.max(o-.25,.5)),W=()=>t(o=>(o+90)%360),a=o=>{switch(o){case"approved":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";case"pending":return"bg-yellow-100 text-yellow-800";default:return"bg-blue-100 text-blue-800"}},k=o=>o?o>.8?"text-green-600":o>.5?"text-yellow-600":"text-red-600":"text-gray-500";return m?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx(Q,{className:"h-8 w-8 animate-spin text-indigo-600"})}):n?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("button",{onClick:()=>p("/admin/documents"),className:"flex items-center text-gray-600 hover:text-gray-900",children:[e.jsx(Le,{className:"h-5 w-5 mr-2"}),"Back to Documents"]}),e.jsx("div",{className:"flex items-center space-x-3",children:e.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${a(n.status)}`,children:n.status})})]}),e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[e.jsx(X,{className:"h-6 w-6 mr-3 text-gray-400"}),n.fileName]}),e.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Customer: ",n.customerId]}),e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),"Tax Year: ",n.taxYear]}),e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(Me,{className:"h-4 w-4 mr-2"}),"Category: ",e.jsx("span",{className:"ml-1 capitalize",children:n.category})]}),e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),"Uploaded: ",n.uploadedAt instanceof q?new Date(n.uploadedAt.toDate()).toLocaleString():new Date(n.uploadedAt).toLocaleString()]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Document Preview"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:O,className:"p-2 hover:bg-gray-100 rounded-lg",title:"Zoom Out",children:e.jsx(Re,{className:"h-5 w-5 text-gray-600"})}),e.jsxs("span",{className:"text-sm text-gray-600",children:[Math.round(y*100),"%"]}),e.jsx("button",{onClick:R,className:"p-2 hover:bg-gray-100 rounded-lg",title:"Zoom In",children:e.jsx(Ue,{className:"h-5 w-5 text-gray-600"})}),e.jsx("button",{onClick:W,className:"p-2 hover:bg-gray-100 rounded-lg",title:"Rotate",children:e.jsx(Pe,{className:"h-5 w-5 text-gray-600"})}),e.jsx("a",{href:C,download:n.fileName,className:"p-2 hover:bg-gray-100 rounded-lg",title:"Download",children:e.jsx(Ye,{className:"h-5 w-5 text-gray-600"})})]})]}),e.jsx("div",{className:"border rounded-lg overflow-hidden bg-gray-50",style:{height:"600px"},children:C?e.jsx("div",{className:"w-full h-full overflow-auto flex items-center justify-center",children:e.jsx("img",{src:C,alt:n.fileName,className:"max-w-none transition-transform duration-200",style:{transform:`scale(${y}) rotate(${b}deg)`,transformOrigin:"center"}})}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx(X,{className:"h-12 w-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"No preview available"})]})})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"AI Analysis"}),e.jsxs("div",{className:"space-y-4",children:[n.aiConfidence&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Confidence Score"}),e.jsxs("span",{className:`text-sm font-semibold ${k(n.aiConfidence)}`,children:[Math.round(n.aiConfidence*100),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${n.aiConfidence>.8?"bg-green-500":n.aiConfidence>.5?"bg-yellow-500":"bg-red-500"}`,style:{width:`${n.aiConfidence*100}%`}})})]}),n.amount&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Detected Amount"}),e.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:["CHF ",n.amount.toLocaleString()]})]}),n.aiSummary&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 block mb-2",children:"AI Summary"}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-3",children:e.jsx("p",{className:"text-sm text-gray-600",children:n.aiSummary})})]})]})]}),e.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Expert Notes"}),e.jsxs("button",{onClick:V,disabled:c,className:"inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50",children:[c?e.jsx(Q,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(Fe,{className:"h-4 w-4 mr-2"}),"Save Notes"]})]}),e.jsx("textarea",{value:i,onChange:o=>x(o.target.value),className:"w-full h-32 px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"Add your review notes here..."})]}),e.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Actions"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>D({action:"approved",show:!0}),disabled:c||n.status==="approved",className:"w-full inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50",children:[e.jsx(pe,{className:"h-5 w-5 mr-2"}),"Approve Document"]}),e.jsxs("button",{onClick:()=>D({action:"rejected",show:!0}),disabled:c||n.status==="rejected",className:"w-full inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50",children:[e.jsx(fe,{className:"h-5 w-5 mr-2"}),"Reject Document"]}),e.jsxs("button",{onClick:()=>p(`/admin/messages?customerId=${n.customerId}`),className:"w-full inline-flex items-center justify-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[e.jsx(H,{className:"h-5 w-5 mr-2"}),"Request More Information"]})]})]})]})]}),N.show&&e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:["Confirm ",N.action==="approved"?"Approval":"Rejection"]}),e.jsxs("p",{className:"text-sm text-gray-500 mb-6",children:["Are you sure you want to ",N.action==="approved"?"approve":"reject"," this document? This action will update the document status and notify the customer."]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>D({...N,show:!1}),className:"px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{onClick:()=>M(N.action),className:`px-4 py-2 text-sm font-medium rounded-md text-white ${N.action==="approved"?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700"}`,children:c?e.jsx(Q,{className:"h-4 w-4 animate-spin"}):"Confirm"})]})]})})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ue,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Document not found"})]})},ls=()=>{const{currentUser:l,isAdmin:p}=Z(),[f,n]=r.useState([]),[d,C]=r.useState([]),[S,m]=r.useState(!0),[j,c]=r.useState(""),[u,i]=r.useState("all"),[x,y]=r.useState("all");r.useEffect(()=>{l&&(async()=>{try{const t=[A("role","==","customer"),J("name")];l.role==="expert"&&t.push(A("assignedExpertId","==",l.id));const N=$(E(w,"users"),...t),D=F(N,async L=>{const M=[];for(const V of L.docs){const R={id:V.id,...V.data()},O=$(E(w,"documents"),A("customerId","==",R.id)),W=await qe(O);let a=0,k=0,o=R.updatedAt;W.forEach(s=>{var h;const v=s.data();v.status==="pending"?a++:v.status==="approved"&&k++,(h=v.uploadedAt)!=null&&h.toDate&&(!o||v.uploadedAt.toDate()>o)&&(o=v.uploadedAt.toDate())}),M.push({...R,documentCount:W.size,pendingDocuments:a,completedDocuments:k,lastActivity:o})}n(M),m(!1)});return()=>D()}catch(t){console.error("Error loading customers:",t),m(!1)}})()},[l,p]),r.useEffect(()=>{let t=[...f];j&&(t=t.filter(N=>{var D,L;return N.name.toLowerCase().includes(j.toLowerCase())||N.email.toLowerCase().includes(j.toLowerCase())||((D=N.canton)==null?void 0:D.toLowerCase().includes(j.toLowerCase()))||((L=N.municipality)==null?void 0:L.toLowerCase().includes(j.toLowerCase()))})),u!=="all"&&(t=t.filter(N=>N.canton===u)),x==="active"?t=t.filter(N=>N.pendingDocuments>0):x==="inactive"&&(t=t.filter(N=>N.pendingDocuments===0)),C(t)},[f,j,u,x]);const g=Array.from(new Set(f.map(t=>t.canton).filter(Boolean))).sort(),b=t=>t.documentCount===0?0:Math.round(t.completedDocuments/t.documentCount*100);return S?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Customer Management"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Manage and view all customer profiles and their documents"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(le,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"Search by name, email, canton, or municipality...",value:j,onChange:t=>c(t.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{className:"block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",value:x,onChange:t=>y(t.target.value),children:[e.jsx("option",{value:"all",children:"All Customers"}),e.jsx("option",{value:"active",children:"Active (Pending Docs)"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Canton"}),e.jsxs("select",{className:"block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",value:u,onChange:t=>i(t.target.value),children:[e.jsx("option",{value:"all",children:"All Cantons"}),g.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:d.length})," of"," ",e.jsx("span",{className:"font-medium",children:f.length})," customers"]})})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2",children:d.length>0?d.map(t=>e.jsx("div",{className:"bg-white shadow rounded-lg hover:shadow-lg transition-shadow",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-12 w-12 rounded-full bg-indigo-100 flex items-center justify-center",children:e.jsx("span",{className:"text-indigo-600 font-medium text-lg",children:t.name.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:t.name}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500 mt-1",children:[e.jsx(he,{className:"h-4 w-4 mr-1"}),t.email]})]})]}),t.assignedExpertId&&e.jsxs("div",{className:"flex items-center text-sm text-green-600",children:[e.jsx(je,{className:"h-4 w-4 mr-1"}),"Assigned"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4 text-sm",children:[t.canton&&e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(ze,{className:"h-4 w-4 mr-2"}),t.canton,", ",t.municipality]}),t.lastActivity&&e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),"Last active: ",new Date(t.lastActivity).toLocaleDateString()]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Total Docs"}),e.jsx("div",{className:"text-xl font-semibold text-gray-900",children:t.documentCount})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Pending"}),e.jsx("div",{className:"text-xl font-semibold text-yellow-600",children:t.pendingDocuments})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Completed"}),e.jsx("div",{className:"text-xl font-semibold text-green-600",children:t.completedDocuments})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Completion"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[b(t),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-indigo-600 h-2 rounded-full",style:{width:`${b(t)}%`}})})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs(T,{to:`/admin/customers/${t.id}`,className:"flex-1 inline-flex items-center justify-center px-3 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:["View Profile",e.jsx(Ve,{className:"h-4 w-4 ml-1"})]}),e.jsxs(T,{to:`/admin/documents?customer=${t.id}`,className:"flex-1 inline-flex items-center justify-center px-3 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[e.jsx(X,{className:"h-4 w-4 mr-1"}),"Documents"]}),e.jsxs(T,{to:`/admin/messages?customerId=${t.id}`,className:"flex-1 inline-flex items-center justify-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[e.jsx(H,{className:"h-4 w-4 mr-1"}),"Message"]})]})]})]})},t.id)):e.jsxs("div",{className:"col-span-2 text-center py-12",children:[e.jsx(ne,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No customers found matching your filters"})]})})]})},is=()=>{var l,p;const[f]=Oe(),n=f.get("customerId"),{currentUser:d}=Z(),[C,S]=r.useState([]),[m,j]=r.useState(null),[c,u]=r.useState([]),[i,x]=r.useState(""),[y,g]=r.useState(""),[b,t]=r.useState(!0),[N,D]=r.useState(!1),L=r.useRef(null),M=r.useRef(null);r.useEffect(()=>{d&&(async()=>{try{const s=$(E(w,"conversations"),A("expertId","==",d.id),J("updatedAt","desc")),h=F(s,async v=>{const U=[];for(const P of v.docs){const Y={id:P.id,...P.data()},B=await se(z(w,"users",Y.customerId));B.exists()?U.push({...Y,customerData:{id:B.id,...B.data()}}):U.push(Y)}if(S(U),n&&!m){const P=U.find(Y=>Y.customerId===n);P&&j(P)}t(!1)});return()=>h()}catch(s){console.error("Error loading conversations:",s),t(!1)}})()},[d,n,m]),r.useEffect(()=>{if(!m){u([]);return}const s=$(E(w,"messages"),A("conversationId","==",m.id),J("sentAt","asc")),h=F(s,async v=>{const U=[],P=[];for(const Y of v.docs){const B={id:Y.id,...Y.data()};U.push(B),B.senderRole==="customer"&&!B.isRead&&P.push(Y.id)}u(U),P.length>0&&(V(P),R()),setTimeout(()=>a(),100)});return()=>h()},[m]);const V=async s=>{try{const h=s.map(v=>G(z(w,"messages",v),{isRead:!0,readAt:K()}));await Promise.all(h)}catch(h){console.error("Error marking messages as read:",h)}},R=async()=>{if(m)try{await G(z(w,"conversations",m.id),{unreadCountExpert:0,updatedAt:K()})}catch(s){console.error("Error updating conversation unread count:",s)}},O=async()=>{var s;if(!(!i.trim()||!m||!d)){D(!0);try{await Qe(E(w,"messages"),{conversationId:m.id,senderId:d.id,senderRole:d.role,senderName:d.name,content:i,isRead:!1,sentAt:K()}),await G(z(w,"conversations",m.id),{lastMessage:i,lastMessageTime:K(),unreadCountCustomer:(m.unreadCountCustomer||0)+1,updatedAt:K()}),x(""),(s=M.current)==null||s.focus()}catch(h){console.error("Error sending message:",h)}finally{D(!1)}}},W=s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),O())},a=()=>{var s;(s=L.current)==null||s.scrollIntoView({behavior:"smooth"})},k=s=>{if(!s)return"";const h=s instanceof q?s.toDate():new Date(s),v=new Date;return h.toDateString()===v.toDateString()?h.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):h.toLocaleDateString("en-US",{month:"short",day:"numeric"})},o=C.filter(s=>{var h,v;return((h=s.customerData)==null?void 0:h.name.toLowerCase().includes(y.toLowerCase()))||((v=s.customerData)==null?void 0:v.email.toLowerCase().includes(y.toLowerCase()))});return b?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"})}):e.jsxs("div",{className:"bg-white rounded-lg shadow-lg h-[calc(100vh-180px)] flex",children:[e.jsxs("div",{className:`w-full lg:w-1/3 border-r border-gray-200 flex flex-col ${m?"hidden lg:flex":"flex"}`,children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(le,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"Search conversations...",value:y,onChange:s=>g(s.target.value)})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:o.length>0?o.map(s=>{var h;return e.jsx("div",{onClick:()=>j(s),className:`p-4 border-b border-gray-100 hover:bg-gray-50 cursor-pointer transition-colors ${(m==null?void 0:m.id)===s.id?"bg-indigo-50":""}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center flex-1",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center",children:e.jsx(ae,{className:"h-6 w-6 text-gray-600"})}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:((h=s.customerData)==null?void 0:h.name)||"Unknown Customer"}),s.lastMessageTime&&e.jsx("p",{className:"text-xs text-gray-500",children:k(s.lastMessageTime)})]}),e.jsx("p",{className:"text-sm text-gray-500 truncate",children:s.lastMessage||"No messages yet"})]})]}),s.unreadCountExpert>0&&e.jsx("span",{className:"ml-2 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-white bg-red-500 rounded-full",children:s.unreadCountExpert})]})},s.id)}):e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx(H,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No conversations found"})]})})]}),e.jsx("div",{className:`flex-1 flex flex-col ${m?"flex":"hidden lg:flex"}`,children:m?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-4 border-b border-gray-200 bg-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>j(null),className:"lg:hidden mr-3 p-2 rounded-md hover:bg-gray-100",children:e.jsx(We,{className:"h-5 w-5"})}),e.jsx("div",{className:"flex-shrink-0 h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center",children:e.jsx(ae,{className:"h-6 w-6 text-gray-600"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:((l=m.customerData)==null?void 0:l.name)||"Unknown Customer"}),e.jsx("p",{className:"text-xs text-gray-500",children:(p=m.customerData)==null?void 0:p.email})]})]}),e.jsx("button",{className:"p-2 rounded-md hover:bg-gray-100",children:e.jsx(xe,{className:"h-5 w-5 text-gray-600"})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 bg-gray-50",children:c.length>0?e.jsxs("div",{className:"space-y-4",children:[c.map(s=>e.jsx("div",{className:`flex ${s.senderRole===(d==null?void 0:d.role)?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${s.senderRole===(d==null?void 0:d.role)?"bg-indigo-600 text-white":"bg-white text-gray-900 shadow"}`,children:[e.jsx("p",{className:"text-sm",children:s.content}),e.jsxs("div",{className:`flex items-center justify-end mt-1 space-x-1 ${s.senderRole===(d==null?void 0:d.role)?"text-indigo-200":"text-gray-400"}`,children:[e.jsx("span",{className:"text-xs",children:k(s.sentAt)}),s.senderRole===(d==null?void 0:d.role)&&(s.isRead?e.jsx(Ze,{className:"h-3 w-3"}):e.jsx(Be,{className:"h-3 w-3"}))]})]})},s.id)),e.jsx("div",{ref:L})]}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx(H,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-gray-500",children:"No messages yet. Start the conversation!"})]})})}),e.jsx("div",{className:"p-4 border-t border-gray-200 bg-white",children:e.jsxs("div",{className:"flex items-end space-x-2",children:[e.jsx("button",{className:"p-2 rounded-md hover:bg-gray-100",children:e.jsx(He,{className:"h-5 w-5 text-gray-600"})}),e.jsx("button",{className:"p-2 rounded-md hover:bg-gray-100",children:e.jsx(Xe,{className:"h-5 w-5 text-gray-600"})}),e.jsx("textarea",{ref:M,value:i,onChange:s=>x(s.target.value),onKeyPress:W,placeholder:"Type your message...",className:"flex-1 resize-none border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",rows:1,disabled:N}),e.jsx("button",{onClick:O,disabled:!i.trim()||N,className:"p-2 rounded-lg bg-indigo-600 text-white hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:e.jsx(_e,{className:"h-5 w-5"})})]})})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(H,{className:"h-16 w-16 mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-xl text-gray-500",children:"Select a conversation to start messaging"})]})})})]})},ds=()=>e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Analytics Dashboard"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Analytics features coming soon..."})]}),cs=()=>e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Assignment Management"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Manage customer-expert assignments"})]}),os=()=>e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Customer Profile"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Detailed customer information"})]}),ms=()=>e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Settings"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Account and system settings"})]}),us=()=>e.jsx(es,{children:e.jsxs(Ne,{children:[e.jsx(I,{path:"/login",element:e.jsx(ts,{})}),e.jsxs(I,{element:e.jsx(oe,{children:e.jsx(ss,{})}),children:[e.jsx(I,{index:!0,element:e.jsx(te,{to:"/admin/dashboard",replace:!0})}),e.jsx(I,{path:"/dashboard",element:e.jsx(as,{})}),e.jsx(I,{path:"/documents",element:e.jsx(rs,{})}),e.jsx(I,{path:"/documents/:id",element:e.jsx(ns,{})}),e.jsx(I,{path:"/customers",element:e.jsx(ls,{})}),e.jsx(I,{path:"/customers/:id",element:e.jsx(os,{})}),e.jsx(I,{path:"/messages",element:e.jsx(is,{})}),e.jsx(I,{path:"/analytics",element:e.jsx(ds,{})}),e.jsx(I,{path:"/assignments",element:e.jsx(oe,{requireAdmin:!0,children:e.jsx(cs,{})})}),e.jsx(I,{path:"/settings",element:e.jsx(ms,{})})]}),e.jsx(I,{path:"*",element:e.jsx(te,{to:"/admin/dashboard",replace:!0})})]})});export{us as default};
